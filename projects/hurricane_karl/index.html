<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Calculating rain rate from radar reflectivity of Hurricane Karl | Pearl Ayem</title> <meta name="author" content="Pearl Ayem"> <meta name="description" content="Skills - python, hdf files, rasterio, ECMWF, weather forecasting, geoproj, numpy, pyproj, cloudsat"> <meta name="keywords" content="data-modelling, climate-change, net-zero, esg, sustainability,"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://pearl-ayem.github.io/projects/hurricane_karl/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Pearl Ayem</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About Me</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Data Science Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Curriculum Vitae</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Calculating rain rate from radar reflectivity of Hurricane Karl</h1> <p class="post-description">Skills - python, hdf files, rasterio, ECMWF, weather forecasting, geoproj, numpy, pyproj, cloudsat</p> </header> <article> <h1 id="introduction">Introduction</h1> <p>This research project was carried out to see radar reflectivity values in storms, and calculate the rain rate from the radar pulses. The raw data files are in the hdf format and obtained from <a href="https://www.cloudsat.cira.colostate.edu/" rel="external nofollow noopener" target="_blank">Cloudsatâ€™s Data Center</a>.<br> <br> Related projects: <a href="_projects\hurricane_julia.md">Hurricane Julia</a> <br> This work finds the the point at which the ECMWF tempearture= 0 deg C for each radar pulse and overlays that on the reflectivity plot to check to see whether the bright band occurs at the freezing level. It will also plot the rain rate for the storm track along with the corresponding radar reflectivity to study the eye of the storm <br><br></p> <h3 id="storm-details-">Storm Details <br> </h3> <p><strong>Name:</strong> Hurricane Karl <br> <strong>Year:</strong> 2010 <br> <strong>Region:</strong> Atlantic Basin (Landfall in Yucatan Peninsula of Mexico )<br> <a href="https://en.wikipedia.org/wiki/Hurricane_Karl" rel="external nofollow noopener" target="_blank">Wiki Reference and Storm Details</a></p> <p>The full notebook with this work is at the <a href="https://github.com/Pearl-Ayem/Atmospheric-Radiation-Notebook-Data/blob/master/notebooks/cloudsat_precip_Karl-PA.ipynb" rel="external nofollow noopener" target="_blank">github project</a> for this analysis.</p> <p><br><br></p> <h3 id="1-after-reading-the-height-and-reflectivity-raw-data-from-the-hdf-files-i-plot-the-rain-rates">1. After reading the height and reflectivity raw data from the hdf files, I plot the rain rates:</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rain_rate</span> <span class="o">=</span> <span class="nc">HDFvd_read</span><span class="p">(</span><span class="n">r_file</span><span class="p">,</span><span class="sh">'</span><span class="s">rain_rate</span><span class="sh">'</span><span class="p">,</span><span class="n">vgroup</span><span class="o">=</span><span class="sh">'</span><span class="s">Data Fields</span><span class="sh">'</span><span class="p">)</span>
<span class="n">invalid</span> <span class="o">=</span> <span class="p">(</span><span class="n">rain_rate</span> <span class="o">==</span> <span class="o">-</span><span class="mf">9999.</span><span class="p">)</span>
<span class="n">rain_rate</span><span class="p">[</span><span class="n">invalid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="n">hit</span> <span class="o">=</span> <span class="n">rain_rate</span> <span class="o">&lt;</span> <span class="mi">0</span>
<span class="n">rain_rate</span><span class="p">[</span><span class="n">hit</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">rain_rate</span><span class="p">[</span><span class="n">hit</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">rain_rate</span><span class="p">);</span>
</code></pre></div></div> <div class="row"> <div class="col-sm"> <figure> <picture> <img src="/assets/img/hurricane_karl_rain_rate.png" class="img-fluid z-depth-1" width="auto" height="auto" title="hurricane_karl_rain_rate" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="2-creating-a-masked-array-of-the-reflectivity-so-that-pcolormesh-will-plot-it">2. Creating a masked array of the reflectivity so that pcolormesh will plot it</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hit</span><span class="o">=</span><span class="p">(</span><span class="n">radar_reflectivity</span> <span class="o">==</span> <span class="n">radar_missing</span><span class="p">)</span>
<span class="n">radar_reflectivity</span><span class="o">=</span><span class="n">radar_reflectivity</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">float</span><span class="p">)</span>
<span class="n">radar_reflectivity</span><span class="p">[</span><span class="n">hit</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="n">zvals</span> <span class="o">=</span> <span class="n">radar_reflectivity</span><span class="o">/</span><span class="n">radar_scale</span>
<span class="n">zvals</span><span class="o">=</span><span class="n">ma</span><span class="p">.</span><span class="nf">masked_invalid</span><span class="p">(</span><span class="n">zvals</span><span class="p">)</span>
</code></pre></div></div> <h3 id="3-find-the-3-minutes-of-the-pass-that-includes-the-storm-then-convert-time-to-distance-to-get-the-greatcircle-distance-between-shots">3. Find the 3 minutes of the pass that includes the storm, then convert time to distance to get the greatcircle distance between shots</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">great_circle</span><span class="o">=</span><span class="n">pyproj</span><span class="p">.</span><span class="nc">Geod</span><span class="p">(</span><span class="n">ellps</span><span class="o">=</span><span class="sh">'</span><span class="s">WGS84</span><span class="sh">'</span><span class="p">)</span>
<span class="n">distance</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="n">storm_lons</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">storm_lats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">len</span><span class="p">(</span><span class="n">storm_lons</span><span class="p">)):</span>
    <span class="n">azi12</span><span class="p">,</span><span class="n">azi21</span><span class="p">,</span><span class="n">step</span><span class="o">=</span> <span class="n">great_circle</span><span class="p">.</span><span class="nf">inv</span><span class="p">(</span><span class="n">storm_lons</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">storm_lats</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">storm_lons</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">storm_lats</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    <span class="n">distance</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">distance</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span><span class="p">)</span>
<span class="n">distance</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span><span class="o">/</span><span class="n">meters2km</span>

</code></pre></div></div> <h3 id="4-make-the-plot-for-rain-rate-and-reflectivity">4. Make the plot for rain rate and reflectivity</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">from</span> <span class="n">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="n">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Normalize</span>
<span class="kn">from</span> <span class="n">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="n">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>

<span class="k">def</span> <span class="nf">plot_field2</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">field</span><span class="p">,</span><span class="n">fig</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    draw a 2 panel plot with different panel sizes.  Put the radar reflectivity in the top panel 
    with a colorbar along the bottom, and pass the second axis back to be filled in later.  Uses 
    the sharex keyword to give both plots the same x axis (distance) and the gridspec class to 
    layout the grid
    </span><span class="sh">"""</span>
    
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="p">.</span><span class="nc">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> 
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">.</span><span class="n">inferno</span>
    <span class="n">col</span><span class="o">=</span><span class="n">ax1</span><span class="p">.</span><span class="nf">pcolormesh</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">field</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">the_norm</span><span class="p">)</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="nf">make_axes_locatable</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="p">.</span><span class="nf">append_axes</span><span class="p">(</span><span class="sh">"</span><span class="s">bottom</span><span class="sh">"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="sh">"</span><span class="s">5%</span><span class="sh">"</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.55</span><span class="p">)</span>
    <span class="n">ax1</span><span class="p">.</span><span class="n">figure</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="sh">'</span><span class="s">both</span><span class="sh">'</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="sh">'</span><span class="s">horizontal</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span>

<span class="n">vmin</span><span class="o">=-</span><span class="mi">30</span>
<span class="n">vmax</span><span class="o">=</span><span class="mi">20</span>
<span class="n">the_norm</span><span class="o">=</span><span class="nc">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="n">clip</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">cmap_ref</span><span class="o">=</span><span class="n">cm</span><span class="p">.</span><span class="n">plasma</span>
<span class="n">cmap_ref</span><span class="p">.</span><span class="nf">set_over</span><span class="p">(</span><span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span>
<span class="n">cmap_ref</span><span class="p">.</span><span class="nf">set_under</span><span class="p">(</span><span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">cmap_ref</span><span class="p">.</span><span class="nf">set_bad</span><span class="p">(</span><span class="sh">'</span><span class="s">0.75</span><span class="sh">'</span><span class="p">)</span> <span class="c1">#75% grey
</span>
<span class="n">cloud_height_km</span><span class="o">=</span><span class="n">radar_height</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">/</span><span class="n">meters2km</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> 
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="nf">plot_field2</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="n">cloud_height_km</span><span class="p">,</span><span class="n">storm_zvals</span><span class="p">.</span><span class="n">T</span><span class="p">,</span><span class="n">fig</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_ref</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">the_norm</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">17</span><span class="p">],</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1200</span><span class="p">))</span>
<span class="n">ax1</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">distance (km)</span><span class="sh">'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="sh">'</span><span class="s">height (km)</span><span class="sh">'</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">equivalent radar reflectivity in dbZe</span><span class="sh">'</span><span class="p">)</span>

<span class="n">ax2</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="n">rain_rate</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">distance (km)</span><span class="sh">'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="sh">'</span><span class="s">rain rate (mm/hour)</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <div class="row"> <div class="col-sm"> <figure> <picture> <img src="/assets/img/hurricane_karl_reflectivity.png" class="img-fluid z-depth-1" width="auto" height="auto" title="hurricane_karl_reflectivity" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="5-get-ecmwf-temps">5. Get ECMWF temps</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">z_file</span><span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">a301</span><span class="p">.</span><span class="n">data_dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="sh">'</span><span class="s">*ECMWF-AUX_GRANULE*hdf</span><span class="sh">'</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">ec_height</span><span class="o">=</span><span class="nc">HDFvd_read</span><span class="p">(</span><span class="n">z_file</span><span class="p">,</span><span class="sh">'</span><span class="s">EC_height</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ec_temps</span><span class="p">,</span> <span class="n">temps_attributes</span> <span class="o">=</span> <span class="nc">HDFsd_read</span><span class="p">(</span><span class="n">z_file</span><span class="p">,</span><span class="sh">'</span><span class="s">Temperature</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ec_missing</span> <span class="o">=</span> <span class="n">temps_attributes</span><span class="p">[</span><span class="sh">'</span><span class="s">missing</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div> <h3 id="6-subsetting-the-ecmwf-data">6. Subsetting the ECMWF data</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bad_temps</span> <span class="o">=</span> <span class="p">(</span><span class="n">ec_temps</span> <span class="o">==</span> <span class="n">ec_missing</span><span class="p">)</span>
<span class="n">ec_temps</span><span class="p">[</span><span class="n">bad_temps</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="n">ec_temps</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">ma</span><span class="p">.</span><span class="nf">masked_invalid</span><span class="p">(</span><span class="n">ec_temps</span><span class="p">)</span>
<span class="n">ec_temps</span> <span class="o">=</span> <span class="n">ec_temps</span> <span class="o">-</span> <span class="mf">273.15</span>
<span class="n">ec_temps</span><span class="o">=</span><span class="n">ec_temps</span><span class="p">[</span><span class="n">time_hit</span><span class="p">,:]</span>
</code></pre></div></div> <h3 id="7-ecmwf-temperatures-for-the-segment">7. ECMWF temperatures for the segment</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">field</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    given an axis, draw a cloudsat cross section
    </span><span class="sh">"""</span>
    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">.</span><span class="n">inferno</span>
    <span class="n">col</span><span class="o">=</span><span class="n">ax</span><span class="p">.</span><span class="nf">pcolormesh</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">field</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                  <span class="n">norm</span><span class="o">=</span><span class="n">the_norm</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">figure</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="sh">'</span><span class="s">both</span><span class="sh">'</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">vmin</span><span class="o">=-</span><span class="mi">30</span>
<span class="n">vmax</span><span class="o">=</span><span class="mi">30</span>
<span class="n">the_norm</span><span class="o">=</span><span class="nc">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="n">clip</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">cmap_ec</span><span class="o">=</span> <span class="n">cm</span><span class="p">.</span><span class="n">bwr</span>
<span class="n">cmap_ec</span><span class="p">.</span><span class="nf">set_over</span><span class="p">(</span><span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span>
<span class="n">cmap_ec</span><span class="p">.</span><span class="nf">set_under</span><span class="p">(</span><span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">cmap_ec</span><span class="p">.</span><span class="nf">set_bad</span><span class="p">(</span><span class="sh">'</span><span class="s">0.75</span><span class="sh">'</span><span class="p">)</span> <span class="c1">#75% grey
</span>
<span class="n">ec_height_km</span><span class="o">=</span><span class="n">ec_height</span><span class="o">/</span><span class="n">meters2km</span>
<span class="n">ax</span><span class="o">=</span><span class="nf">plot_field</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="n">ec_height_km</span><span class="p">,</span><span class="n">ec_temps</span><span class="p">.</span><span class="n">T</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap_ec</span><span class="p">,</span>
                  <span class="n">norm</span><span class="o">=</span><span class="n">the_norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1200</span><span class="p">))</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">distance (km)</span><span class="sh">'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="sh">'</span><span class="s">height (km)</span><span class="sh">'</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">ECMWF temps in deg C</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <div class="row"> <div class="col-sm"> <figure> <picture> <img src="/assets/img/hurricane_karl_ECMWF_temps.png" class="img-fluid z-depth-1" width="auto" height="auto" title="hurricane_karl_reflectivity" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="8-read-in-heating-rate">8. Read in heating rate</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">hr_file</span><span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">a301</span><span class="p">.</span><span class="n">data_dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="sh">'</span><span class="s">*FLXHR*hdf</span><span class="sh">'</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">lats</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">date_times</span><span class="p">,</span><span class="n">prof_times</span><span class="p">,</span><span class="n">dem_elevation</span><span class="o">=</span><span class="nf">get_geo</span><span class="p">(</span><span class="n">hr_file</span><span class="p">)</span>
<span class="n">lats</span><span class="o">=</span><span class="n">lats</span><span class="p">.</span><span class="nf">squeeze</span><span class="p">()</span>
<span class="n">lons</span><span class="o">=</span><span class="n">lons</span><span class="p">.</span><span class="nf">squeeze</span><span class="p">()</span>
<span class="n">qr</span><span class="p">,</span> <span class="n">qr_attrs</span> <span class="o">=</span> <span class="nc">HDFsd_read</span><span class="p">(</span><span class="n">hr_file</span><span class="p">,</span><span class="sh">'</span><span class="s">QR</span><span class="sh">'</span><span class="p">)</span>
<span class="n">qr_height</span><span class="p">,</span> <span class="n">height_attrs</span> <span class="o">=</span> <span class="nc">HDFsd_read</span><span class="p">(</span><span class="n">hr_file</span><span class="p">,</span><span class="sh">'</span><span class="s">Height</span><span class="sh">'</span><span class="p">)</span>
<span class="n">factor</span> <span class="o">=</span> <span class="nc">HDFvd_read</span><span class="p">(</span><span class="n">hr_file</span><span class="p">,</span><span class="sh">'</span><span class="s">QR.factor</span><span class="sh">'</span><span class="p">,</span><span class="n">vgroup</span><span class="o">=</span><span class="sh">'</span><span class="s">Swath Attributes</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">missing</span> <span class="o">=</span> <span class="nc">HDFvd_read</span><span class="p">(</span><span class="n">hr_file</span><span class="p">,</span><span class="sh">'</span><span class="s">QR.missing</span><span class="sh">'</span><span class="p">,</span><span class="n">vgroup</span><span class="o">=</span><span class="sh">'</span><span class="s">Swath Attributes</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">units</span> <span class="o">=</span> <span class="nc">HDFvd_read</span><span class="p">(</span><span class="n">hr_file</span><span class="p">,</span><span class="sh">'</span><span class="s">QR.units</span><span class="sh">'</span><span class="p">,</span><span class="n">vgroup</span><span class="o">=</span><span class="sh">'</span><span class="s">Swath Attributes</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#set_trace()
</span><span class="n">hit</span> <span class="o">=</span> <span class="p">(</span><span class="n">qr</span> <span class="o">==</span> <span class="n">missing</span><span class="p">)</span>
<span class="n">qr</span> <span class="o">=</span> <span class="n">qr</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span><span class="o">/</span><span class="n">factor</span>
<span class="n">qr</span><span class="p">[</span><span class="n">hit</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span>


<span class="n">storm_qr</span><span class="o">=</span><span class="n">qr</span><span class="p">[:,</span><span class="n">time_hit</span><span class="p">,:]</span>
<span class="n">storm_height</span><span class="o">=</span><span class="n">qr_height</span><span class="p">[</span><span class="n">time_hit</span><span class="p">,:]</span>
</code></pre></div></div> <h3 id="9-split-out-the-long-and-shortwave-heating-rates">9. Split out the long and shortwave heating rates</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shortwave_qr</span><span class="o">=</span><span class="n">storm_qr</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span>
<span class="n">longwave_qr</span><span class="o">=</span><span class="n">storm_qr</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:]</span>
</code></pre></div></div> <h3 id="10-make-a-plots-for-shortwave-and-longwave-heating-rates-which-look-like-so">10. Make a plots for shortwave and longwave heating rates which look like so:</h3> <div class="row"> <div class="col-sm"> <figure> <picture> <img src="/assets/img/hurricane_karl_lw_sw.png" class="img-fluid z-depth-1" width="auto" height="auto" title="hurricane_karl_reflectivity" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br><br><br></p> <h2 id="more-about-cloudsat">More about Cloudsat</h2> <p>A detailed overview of the Cloudsat mission is given in this <a href="http://cloudsat.atmos.colostate.edu/BAMS_CloudSat_CR.pdf" rel="external nofollow noopener" target="_blank">Bulletin of the AMS article</a> article on cloudsat.</p> <p>From the <a href="https://en.wikipedia.org/wiki/CloudSat" rel="external nofollow noopener" target="_blank">Wikipedia Cloudsat page</a> :</p> <blockquote> <p>Cloudsat is a NASA Earth observation satellite, which was launched on a Delta II rocket on April 28, 2006. It uses radar to measure the altitude and properties of clouds, adding to information on the relationship between clouds and climate in order to help resolve questions about global warming.</p> </blockquote> <p>From the <a href="http://cloudsat.atmos.colostate.edu/" rel="external nofollow noopener" target="_blank">Cloudsat Project Page</a> at the Dept. of Atmospheric Science, Colorado State U:</p> <blockquote> <p>CloudSat flies in formation in the A Train, with several other satellites: Aqua, Aura, CALIPSO and the French PARASOL. CloudSat was selected as a NASA Earth System Science Pathfinder satellite mission in 1999 to provide observations necessary to advance our understanding of cloud abundance, distribution, structure, and radiative properties. Since 2006, CloudSat has flown the first satellite-based millimeter-wavelength cloud radarâ€”a radar that is more than 1000 times more sensitive than existing weather radars.</p> </blockquote> <blockquote> <p>Unlike ground-based weather radars that use centimeter wavelengths to detect raindrop-sized particles, CloudSatâ€™s radar allows us to detect the much smaller particles of liquid water and ice that constitute the large cloud masses that make our weather.</p> </blockquote> <blockquote> <p>CloudSat was co-manifested with the CALIPSO (Cloud-Aerosol Lidar and Infrared Pathfinder Satellite Observations) satellite aboard a Delta II rocket for its launch on 28 April 2006. The satellites fly in a nearly circular orbit with an equatorial altitude of approximately 705 km. The orbit is sun-synchronous, maintaining a roughly fixed angle between the orbital plane and the mean solar meridian. CloudSat maintains a close formation with Aqua and a particularly close formation with CALIPSO, providing near-simultaneous and collocated observations with the instruments on these two platforms.</p> </blockquote> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> Â© Copyright 2024 Pearl Ayem. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>